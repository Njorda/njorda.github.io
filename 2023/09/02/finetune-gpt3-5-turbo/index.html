<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>How to finetune gpt3.5 turbo - Njord tech blog</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Way finetune Finetuning gpt turbo seams to lead to a couple of improvements
Improved steerability Reliable output formatting Custom tone Decreased prompt size The code for this tutorial can be found here
Step by step guide First you need to create an openAI api_key. The eaiest way to do this is through the openAI web page under API keys. . Copy the key and add it to an env file with the name open_ai."><meta property="og:image" content><meta property="og:title" content="How to finetune gpt3.5 turbo"><meta property="og:description" content="Way finetune Finetuning gpt turbo seams to lead to a couple of improvements
Improved steerability Reliable output formatting Custom tone Decreased prompt size The code for this tutorial can be found here
Step by step guide First you need to create an openAI api_key. The eaiest way to do this is through the openAI web page under API keys. . Copy the key and add it to an env file with the name open_ai."><meta property="og:type" content="article"><meta property="og:url" content="https://www.njordy.com/2023/09/02/finetune-gpt3-5-turbo/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-02T00:00:00+00:00"><meta property="article:modified_time" content="2023-09-02T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to finetune gpt3.5 turbo"><meta name=twitter:description content="Way finetune Finetuning gpt turbo seams to lead to a couple of improvements
Improved steerability Reliable output formatting Custom tone Decreased prompt size The code for this tutorial can be found here
Step by step guide First you need to create an openAI api_key. The eaiest way to do this is through the openAI web page under API keys. . Copy the key and add it to an env file with the name open_ai."><link href=https://www.njordy.com/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://www.njordy.com/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css></head><body><div class=content><header><div class=main><a href=https://www.njordy.com/>Njord tech blog</a></div><nav><a href=../../../../>Home</a>
<a href=../../../../posts>All posts</a>
<a href=../../../../about>About</a></nav></header><main><article><div class=title><h1 class=title>How to finetune gpt3.5 turbo</h1><div class=meta>Posted on Sep 2, 2023</div></div><section class=body><h1 id=way-finetune>Way finetune</h1><p>Finetuning gpt turbo seams to lead to a couple of improvements</p><ul><li>Improved steerability</li><li>Reliable output formatting</li><li>Custom tone</li><li>Decreased prompt size</li></ul><p>The code for this tutorial can be found <a href=https://github.com/Njorda/finetune-openai/tree/main>here</a></p><h1 id=step-by-step-guide>Step by step guide</h1><p>First you need to create an openAI api_key. The eaiest way to do this is through the openAI web page under API keys. <img src=../../../../img/open_ai_api_key.png alt="API keys">. Copy the key and add it to an env file with the name open_ai.</p><h2 id=import-libraries-and-set-api-key>Import Libraries and Set API Key</h2><p>Let&rsquo;s start by importing the libraries we need and setting the API key.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> dotenv <span style=color:#f92672>import</span> load_dotenv
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> openai
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>load_dotenv(<span style=color:#e6db74>&#39;.env&#39;</span>)
</span></span><span style=display:flex><span>openai<span style=color:#f92672>.</span>api_key <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>getenv(<span style=color:#e6db74>&#34;open_ai&#34;</span>)
</span></span></code></pre></div><h2 id=create-a-training-file>Create a Training File</h2><p>Next, create a simple file with training examples. The format should be jsonl. The file needs to contain at least 10 examples. Below is a shorter example with only three examples</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{<span style=color:#f92672>&#34;messages&#34;</span>: [{<span style=color:#f92672>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;system&#34;</span>, <span style=color:#f92672>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;Marv is a factual chatbot that is also sarcastic.&#34;</span>}, {<span style=color:#f92672>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;user&#34;</span>, <span style=color:#f92672>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;What&#39;s the capital of France?&#34;</span>}, {<span style=color:#f92672>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;assistant&#34;</span>, <span style=color:#f92672>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;Paris, as if everyone doesn&#39;t know that already.&#34;</span>}]}
</span></span><span style=display:flex><span>{<span style=color:#f92672>&#34;messages&#34;</span>: [{<span style=color:#f92672>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;system&#34;</span>, <span style=color:#f92672>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;Marv is a factual chatbot that is also sarcastic.&#34;</span>}, {<span style=color:#f92672>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;user&#34;</span>, <span style=color:#f92672>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;Who wrote &#39;Romeo and Juliet&#39;?&#34;</span>}, {<span style=color:#f92672>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;assistant&#34;</span>, <span style=color:#f92672>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;Oh, just some guy named William Shakespeare. Ever heard of him?&#34;</span>}]}
</span></span><span style=display:flex><span>{<span style=color:#f92672>&#34;messages&#34;</span>: [{<span style=color:#f92672>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;system&#34;</span>, <span style=color:#f92672>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;Marv is a factual chatbot that is also sarcastic.&#34;</span>}, {<span style=color:#f92672>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;user&#34;</span>, <span style=color:#f92672>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;How far is the Moon from Earth?&#34;</span>}, {<span style=color:#f92672>&#34;role&#34;</span>: <span style=color:#e6db74>&#34;assistant&#34;</span>, <span style=color:#f92672>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;Around 384,400 kilometers. Give or take a few, like that really matters.&#34;</span>}]}
</span></span></code></pre></div><h2 id=create-an-openai-dataset>Create an OpenAI Dataset</h2><p>We then need to create an OpenAI dataset that the model can use for fine-tuning.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>res <span style=color:#f92672>=</span> openai<span style=color:#f92672>.</span>File<span style=color:#f92672>.</span>create(
</span></span><span style=display:flex><span>    file<span style=color:#f92672>=</span>open(<span style=color:#e6db74>&#34;&lt;your example data&gt;&#34;</span>, <span style=color:#e6db74>&#34;r&#34;</span>),
</span></span><span style=display:flex><span>    user_provided_filename<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;small_data&#39;</span>,
</span></span><span style=display:flex><span>    purpose<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;fine-tune&#39;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>res
</span></span></code></pre></div><h2 id=list-all-files-on-openai>List All Files on OpenAI</h2><p>To verify that the file has been uploaded, you can list all the files on OpenAI.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>openai<span style=color:#f92672>.</span>File<span style=color:#f92672>.</span>list()
</span></span></code></pre></div><h2 id=time-to-fine-tune-the-model>Time to Fine-Tune the Model</h2><p>Now, it&rsquo;s time to fine-tune the model.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>res <span style=color:#f92672>=</span> openai<span style=color:#f92672>.</span>FineTuningJob<span style=color:#f92672>.</span>create(
</span></span><span style=display:flex><span>    training_file<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;file-Ly1Zex9VAuGouAjtxd1vsUPL&#39;</span>,
</span></span><span style=display:flex><span>    model<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;gpt-3.5-turbo&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>job_id <span style=color:#f92672>=</span> res[<span style=color:#e6db74>&#34;id&#34;</span>]
</span></span><span style=display:flex><span>res
</span></span></code></pre></div><h2 id=monitor-training-progress>Monitor Training Progress</h2><p>The model will start training. To find out when it is done, you can use the <a href=https://www.pinecone.io/learn/fine-tune-gpt-3.5>following code</a> that includes a sleep loop.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> time <span style=color:#f92672>import</span> sleep
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>    res <span style=color:#f92672>=</span> openai<span style=color:#f92672>.</span>FineTuningJob<span style=color:#f92672>.</span>retrieve(job_id)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> res[<span style=color:#e6db74>&#34;finished_at&#34;</span>] <span style=color:#f92672>!=</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;.&#34;</span>, end<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>        sleep(<span style=color:#ae81ff>10</span>)
</span></span></code></pre></div></section><div class=post-tags></div></article></main><footer><div style=display:flex></div><div class=footer-info>2024 <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer></div></body></html>